​	0是黑色，255是白色。直方图的分布与图形亮度对比度相关。对比度就是一幅图像中明暗区域最明的白和最暗的黑之间，它们的不同亮度层级的差距大小。高对比度的图形直方图分布会覆盖更宽的灰度级别（因为最明最暗层级差别大，中间会覆盖更多的灰度级别），直方图分布就比较均匀。相反低对比度的图像的直方图分布比较窄，而且集中于灰度级的一侧。

（参考）<https://www.cnblogs.com/xujianqing/p/5095338.html>

## 1. 直方图均衡化

​	直方图的分布显示着不同对比度的图像效果，因此直方图的分布时影响着图像的显示的，均匀的直方图分布的图像显示效果一般更好一些（有效改善图像对比度不足的问题）。

​	均衡化指的是 像素点到像素点的变化，使得原本不均匀分布的像素的灰度级别均衡化为均匀分布的灰度级别。
$$
s_k = T(r_k)
$$
​	T( r )在区间[0,L-1]上是单值且单调递增的（从0增到255的）。单增的原因是：如果原来像素点的灰度级别是高级别，那么变换后输出的灰度级别也要是高级别的，避免黑白颠倒，图像就乱样子了

​	当0≤r≤L-1时，0≤T（r）≤L-1。因为输出结果是目标图像的像素灰度级，所以也要在这个范围内。

#### 1.1 举例

​	假设有一个图像4X4的16个像素点，最大灰度级为7，对应的像素点的值如下：

| 4    | 5    | 6    | 6    |
| ---- | ---- | ---- | ---- |
| 5    | 4    | 5    | 5    |
| 6    | 6    | 5    | 5    |
| 5    | 5    | 5    | 6    |

对其进行直方图均衡化，步骤如下：

1. 统计直方图，
2. 求出对应的概率密度
3. 求累积分布函数
4. 求出每个灰度级对应的输出灰度级
5. 映射到新的图像

| 输入灰度级 | 统计直方图 | 概率密度 | 累积分布函数 | 输出灰度级             |
| ---------- | ---------- | -------- | ------------ | ---------------------- |
| 4          | 2          | 0.125    | 0.125        | 0.875=1（就是0.125*7） |
| 5          | 9          | 0.5625   | 0.6875       | 4.8125=5（0.6875*7）   |
| 6          | 5          | 0.3125   | 1            | 7（1*7）               |

​	由于累积分布函数和输入图像的灰度级相乘，不一定得到一个整数，但是输出的灰度级要求整数，一般四舍五入取整数灰度级。

最后输出图像为：

| 1    | 5    | 7    | 7    |
| ---- | ---- | ---- | ---- |
| 5    | 1    | 5    | 5    |
| 7    | 7    | 5    | 5    |
| 5    | 5    | 5    | 7    |

####  1.2 算法实现

​	**不使用封装好的工具实现**

​	（这里面讲了）<https://blog.csdn.net/macunshi/article/details/79804547>

​	**matlab用封装好的工具实现直方图规定化**

```matlab
%使用直方图均衡化
i = imread('images/lena.jpg');
i = rgb2gray(i); % 一定要先转为灰度图像（一维的，彩图是三维的）
imshow(i);title('原图');
% histeq(I, 200)，就是希望均衡化后的直方图只有200个灰度级。 
j = histeq(i,200);
figure(2);
imshow(j);title('直方图均衡化');
% 需要注意的是此时j并不是只有200个灰度级，默认有256个。只是均衡化时只有200个灰度级是有像素数的，其余的灰度级像素数为0
imhist(j);title('j的直方图'); # imhist(j,n) n可以设置显示的灰度级数
```



## 2. 直方图匹配

​	直方图均衡化是对图像自动增强的过程，但有时候并不想要一个均衡化的过程，而是想要一个指定的直方图，这就是直方图的匹配。

#### 2.1 举例

​	实现步骤：

1. 统计输入图像和要匹配图像的直方图（就是统计每个级别对应的像素分别是多少个）
2. 求出输入和匹配图像的灰度级对应的概率密度
3. 求输入和匹配图像的累积分布函数
4. 寻找Pi到Pj最接近的映射，从而得到输入图像灰度级i 映射到的匹配图像的灰度级j，j灰度级即为直方图匹配后的输出图像的灰度级
5. 直方图匹配后的直方图的概率密度就是根据对应的输入图像的直方图概率密度计算得到的。



**假设输入图像的最大灰度级为7**

|         | 操作                                                         |                 |         |         |            |            |            |            |            |
| :-----: | ------------------------------------------------------------ | :-------------: | :-----: | :-----: | :--------: | :--------: | :--------: | :--------: | :--------: |
|    1    | 原始图像含有的灰度级别                                       |        0        |    1    |    2    |     3      |     4      |     5      |     6      |     7      |
|    2    | 原始直方图各灰度级像素点数                                   |       790       |  1023   |   850   |    656     |    329     |    245     |    122     |     81     |
|    3    | 原始直方图概率密度P(r)                                       |      0.19       |  0.25   |  0.21   |    0.16    |    0.08    |    0.06    |    0.03    |    0.02    |
|    4    | 原始直方图累积分布函数Pi                                     |      0.19       |  0.44   |  0.65   |    0.81    |    0.89    |    0.95    |    0.98    |    1.00    |
|    5    | 匹配直方图概率密度P(z)                                       |        0        |    0    |    0    |    0.15    |    0.20    |    0.30    |    0.20    |    0.15    |
|    6    | 匹配直方图累积分布函数Pj                                     |        0        |    0    |    0    |    0.15    |    0.35    |    0.65    |    0.85    |    1.00    |
|    7    | Pi 到 Pj 最接近的映射（i是原始图像的灰度级，j是匹配图像的灰度级）【从而得到灰度级别 i 到 j 的映射】 | 0.19->0.15 0->3 |  1->4   |  2->5   |    3->6    |    4->6    |    5->7    |    6->7    |    7->7    |
| ***8*** | ***变换后的图像灰度级***                                     |     ***3***     | ***4*** | ***5*** |  ***6***   |  ***6***   |  ***7***   |  ***7***   |  ***7***   |
| ***9*** | ***变换后的直方图概率密度***                                 |     ***0***     | ***0*** | ***0*** | ***0.19*** | ***0.25*** | ***0.21*** | ***0.24*** | ***0.11*** |

#### 2.2 算法实现

​	**matlab用封装好的工具实现直方图规定化**

```matlab
I = imread('lena.bmp'); % 读入原图像
I1 = imread('baby.bmp'); % 读入要匹配直方图图像	
[hgram1,x]=imhist(I1) ; % 获取匹配图像的直方图信息，hgram1为每一级别灰度像素的个数；x为灰度级别
J1=histeq(I,hgram1);% 该步为执行直方图匹配。  histeq是直方图均衡化函数，将I的直方图信息转为指定的直方图信息hgram1  相当于执行上面的步骤4,5
subplot(2,3,1);imshow(I);title('原图');
subplot(2,3,2);imshow(I1);title('标准图');
subplot(2,3,3);imshow(J1);title('匹配到标准图');
subplot(2,3,4);imhist(I);title('原图');
subplot(2,3,5);imhist(I1);title('标准图');
subplot(2,3,6);imhist(J1);title('匹配到标准图');
```

